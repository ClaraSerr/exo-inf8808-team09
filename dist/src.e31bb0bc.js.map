{"version":3,"sources":["scripts/helper.js","scripts/preprocess.js","scripts/grouped-quantile.js","index.js","../node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["generateMapG","width","height","d3","select","append","attr","generateMarkerG","setCanvasSize","getClosestStep","nSteps","domain","BEST_STEPS","step","stepDiff","bestStep","length","i","push","Math","abs","getSteps","steps","firstStep","floor","unshift","getQuantiles","array","sort","ascending","quantiles","quantile","median","getWeekNumber","d","Date","UTC","getFullYear","getMonth","getDate","setUTCDate","getUTCDate","getUTCDay","yearStart","getUTCFullYear","weekNo","ceil","addDayType","data","jour_semaine","date","getDay","type_jour","isNaN","voyage","ferie","aggregateData","csvData","vizData","startDate","endDate","typeJour","ligne","girouettes","posLigne","findIndex","e","posGirouette","girouette","Girouette","voyages","posVoyage","arrets","posArret","codeArret","arret_code","nomArret","arret_nom","sequenceArret","sequence_arret","minutesEcart","Map","moyMinutesEcart","nClients","moyNClients","ponctualite","tauxPonctualite","minutesEcartClient","moyMinutesEcartClient","set","Minutes_ecart_planifie","montants","Etat_Ponctualite","forEach","arret","sumMinutesEcart","v","size","sumNClients","sumMinutesEcartClient","countPonctuel","aggregateDataForViz3","lignes","posDate","valueOf","MARGIN","top","right","bottom","left","FONT_SIZE","DIRECTIONS_ANGLE","QUANTILE_STROKE_COLOR","QUANTILE_FILL_COLOR","QUANTILE_STROKE_WIDTH","NUMBER_OF_TICKS","GRADIENT_COLORS","GRADIENT_THRESHOLDS","selectValue","generateViz3","container","delayGraphContainer","style","trafficGraphContainer","lines","directions","ResizeObserver","generateDelayGraph","observe","node","generateTrafficGraph","quantileSets","getDelayQuantileSets","title","generateGroupedQuantileGraph","svg","dataScale","HEIGHT","getBoundingClientRect","WIDTH","min","selectAll","enter","insert","text","legend","middleY","squareWidth","paddingX","paddingY","getTrafficQuantileSets","quantileTripSets","quantileDaySets","quantileWeekSets","weekOption","document","createElement","value","innerHTML","dayOption","tripOption","appendChild","addEventListener","setTrafficGraph","setAttribute","toString","html","BAR_WIDTH","linesScale","scaleOrdinal","range","directionsRange","line","directionsScale","maxValue","Number","MIN_SAFE_INTEGER","minValue","MAX_SAFE_INTEGER","scaleLinear","xAxis","lineValuesY","directionValuesY","x","yAxis","helper","y","bars","q3","q2","q1","yValues","minOffset","centerOffset","max","j","round","on","delaySets","day","direction","trip","stop","delaySet","tripSets","daySets","weekSets","lastWeek","parse","weekClients","week","dayClients","tripClients","tripSet","daySet","weekSet","svgSize","build","csv","then","arret_Latitude","arret_Longitude","preprocess","groupedQuantile","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","event","JSON","type","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","id","every","generated","js","console","clear","hmrApply","hmrAcceptRun","reload","close","onclose","log","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","body","getElementById","remove","stackTrace","innerText","getParents","modules","parents","k","dep","Array","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"src.e31bb0bc.js","sourceRoot":"..\\src","sourcesContent":["\r\n/**\r\n * Generates the SVG element g which will contain the map base.\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n * @returns {*} The d3 Selection for the created g element\r\n */\r\nexport function generateMapG (width, height) {\r\n  return d3.select('.graph')\r\n    .select('svg')\r\n    .append('g')\r\n    .attr('id', 'map-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n/**\r\n * Generates the SVG element g which will contain the map markers.\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n * @returns {*} The d3 Selection for the created g element\r\n */\r\nexport function generateMarkerG (width, height) {\r\n  return d3.select('.graph')\r\n    .select('svg')\r\n    .append('g')\r\n    .attr('id', 'marker-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n/**\r\n * Sets the size of the SVG canvas containing the graph.\r\n *\r\n * @param {number} width The desired width\r\n * @param {number} height The desired height\r\n */\r\nexport function setCanvasSize (width, height) {\r\n  d3.select('#map').select('svg')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n\r\n/**\r\n * @param {number} nSteps The ideal number of steps\r\n * @param {*} domain Domain of d3 scale\r\n * @returns {number} The best step to use\r\n */\r\nexport function getClosestStep (nSteps, domain) {\r\n  const BEST_STEPS = [\r\n    0.1, 0.2, 0.25, 0.5,\r\n    1, 2, 2.5, 5,\r\n    10, 20, 25, 50,\r\n    100, 200, 250, 500,\r\n    1000, 2000, 2500, 5000,\r\n    10000, 20000, 25000, 50000\r\n  ]\r\n  var step = (domain[1] - domain[0]) / nSteps\r\n  var stepDiff = []\r\n  var bestStep = BEST_STEPS[BEST_STEPS.length - 1]\r\n  for (let i = 0; i < BEST_STEPS.length; i++) {\r\n    stepDiff.push(Math.abs(BEST_STEPS[i] - step))\r\n    if (i > 0 && stepDiff[i] > stepDiff[i - 1]) {\r\n      bestStep = BEST_STEPS[i - 1]\r\n      break\r\n    }\r\n  }\r\n  return bestStep\r\n}\r\n\r\n/**\r\n * @param {number} nSteps The ideal number of steps\r\n * @param {*} domain Domain of d3 scale\r\n * @returns {Array<number>} The best steps\r\n */\r\nexport function getSteps (nSteps, domain) {\r\n  var step = getClosestStep(nSteps, domain)\r\n  var steps = []\r\n  if (domain[0] <= 0 && domain[1] >= 0) {\r\n    steps.push(0)\r\n  } else {\r\n    let firstStep = Math.floor(domain[0])\r\n    while (firstStep % step !== 0) {\r\n      firstStep += 1\r\n    }\r\n    steps.push(firstStep)\r\n  }\r\n  while (steps[steps.length - 1] < domain[1] - step) {\r\n    steps.push(steps[steps.length - 1] + step)\r\n  }\r\n  while (steps[0] > domain[0] + step) {\r\n    steps.unshift(steps[0] - step)\r\n  }\r\n  return steps\r\n}\r\n\r\n/**\r\n * @param {Array<number>} array Array of numeric values\r\n * @returns {Array<number>} The quantiles\r\n */\r\nexport function getQuantiles (array) {\r\n  array = array.sort(d3.ascending)\r\n  const quantiles = [\r\n    array[0],\r\n    d3.quantile(array, 0.25),\r\n    d3.median(array),\r\n    d3.quantile(array, 0.75),\r\n    array[array.length - 1]\r\n  ]\r\n  return quantiles\r\n}\r\n\r\n/**\r\n * @param {Date} d date\r\n * @returns {number} weekNo\r\n */\r\nexport function getWeekNumber (d) {\r\n  // Copy date so don't modify original\r\n  d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()))\r\n  // Set to nearest Thursday: current date + 4 - current day number\r\n  // Make Sunday's day number 7\r\n  d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7))\r\n  // Get first day of year\r\n  var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1))\r\n  // Calculate full weeks to nearest Thursday\r\n  var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7)\r\n  // Return array of year and week number\r\n  return [d.getUTCFullYear(), weekNo]\r\n}\r\n","// INF8808 - Exo\r\n//\r\n// Adam Prévost - 1947205\r\n// Armelle Jézéquel - 2098157\r\n// Clara Serruau - 2164678\r\n// Jules Lefebvre - 1847158\r\n// Julien Dupuis - 1960997\r\n//\r\n\r\n/**\r\n * Ajout de champs à l'objet\r\n * jour_semaine {0, 1, 2, 3, 4, 5, 6} où 0 = Dimanche\r\n * type_jour {semaine, fin de semaine}\r\n * ferie {true, false}\r\n *\r\n * @param {object[]} data L'array d'objets qui contient les lignes du csv\r\n */\r\nexport function addDayType (data) {\r\n  for (var i = 0; i < data.length; i++) {\r\n    // jour_semaine\r\n    data[i].jour_semaine = data[i].date.getDay()\r\n\r\n    // type_jour\r\n    data[i].jour_semaine === (0 || 6) ? data[i].type_jour = 'fin de semaine' : data[i].type_jour = 'semaine'\r\n\r\n    // ferie\r\n    isNaN(data[i].voyage) ? data[i].ferie = true : data[i].ferie = false\r\n  }\r\n}\r\n/**\r\n * aggregateData() remplit l'objet vizData à partir des données du csv (data)\r\n *\r\n * @param {*} csvData L'array d'objets qui contient les lignes du csv, modifié par preprocess.addDayType()\r\n * @param {*} vizData L'array d'objets qui contient les données consolidées requises pour générer les viz\r\n * @param {*} startDate Date de début\r\n * @param {*} endDate Date de fin\r\n * @param {*} typeJour On considère semaine ou weekend\r\n * @param {*} ferie On considère les fériés si true\r\n */\r\nexport function aggregateData (csvData, vizData, startDate, endDate, typeJour, ferie) {\r\n  // Boucle sur les lignes de csvData pour remplir la structure vizData\r\n  for (var i = 0; i < csvData.length; i++) {\r\n    if (csvData[i].date >= startDate && csvData[i].date <= endDate && csvData[i].type_jour === typeJour && csvData[i].ferie === ferie) {\r\n      if (vizData.length === 0) {\r\n        vizData.push({ ligne: csvData[i].ligne, girouettes: [] })\r\n      }\r\n\r\n      // On ajoute la ligne si elle n'existe pas déjà dans vizData\r\n      var posLigne = vizData.findIndex(e => e.ligne === csvData[i].ligne)\r\n      if (posLigne === -1) {\r\n        vizData.push({ ligne: csvData[i].ligne, girouettes: [] })\r\n        posLigne = vizData.length - 1\r\n      }\r\n\r\n      // On ajoute la girouette si elle n'existe pas déjà dans vizData\r\n      var posGirouette = vizData[posLigne].girouettes.findIndex(e => e.girouette === csvData[i].Girouette)\r\n      if (posGirouette === -1) {\r\n        vizData[posLigne].girouettes.push({ girouette: csvData[i].Girouette, voyages: [] })\r\n        posGirouette = vizData[posLigne].girouettes.length - 1\r\n      }\r\n\r\n      // On ajoute le voyage s'il n'existe pas déjà dans vizData\r\n      var posVoyage = vizData[posLigne].girouettes[posGirouette].voyages.findIndex(e => e.voyage === csvData[i].voyage)\r\n      if (posVoyage === -1) {\r\n        vizData[posLigne].girouettes[posGirouette].voyages.push({ voyage: csvData[i].voyage, arrets: [] })\r\n        posVoyage = vizData[posLigne].girouettes[posGirouette].voyages.length - 1\r\n      }\r\n\r\n      // On ajoute l'arrêt s'il n'existe pas déjà dans vizData\r\n      var posArret = vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.findIndex(e => e.codeArret === csvData[i].arret_code)\r\n      if (posArret === -1) {\r\n        vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.push(\r\n          {\r\n            codeArret: csvData[i].arret_code,\r\n            nomArret: csvData[i].arret_nom,\r\n            sequenceArret: csvData[i].sequence_arret,\r\n            minutesEcart: new Map(),\r\n            moyMinutesEcart: null,\r\n            nClients: new Map(),\r\n            moyNClients: null,\r\n            ponctualite: new Map(),\r\n            tauxPonctualite: null,\r\n            minutesEcartClient: new Map(),\r\n            moyMinutesEcartClient: null\r\n          })\r\n        posArret = vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.length - 1\r\n      }\r\n\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].minutesEcart.set(csvData[i].date, csvData[i].Minutes_ecart_planifie)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].nClients.set(csvData[i].date, csvData[i].montants)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].ponctualite.set(csvData[i].date, csvData[i].Etat_Ponctualite)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].minutesEcartClient.set(csvData[i].date, csvData[i].Minutes_ecart_planifie * csvData[i].montants)\r\n    }\r\n  }\r\n\r\n  // Parcours de vizData pour calculer les indicateurs pour chaque ligne.arret\r\n  vizData.forEach(function (ligne) {\r\n    ligne.girouettes.forEach(function (girouette) {\r\n      girouette.voyages.forEach(function (voyage) {\r\n        voyage.arrets.forEach(function (arret) {\r\n          var sumMinutesEcart = 0\r\n          arret.minutesEcart.forEach(v => { sumMinutesEcart += v })\r\n          arret.moyMinutesEcart = sumMinutesEcart / arret.minutesEcart.size\r\n\r\n          var sumNClients = 0\r\n          arret.nClients.forEach(v => { sumNClients += v })\r\n          arret.moyNClients = sumNClients / arret.nClients.size\r\n\r\n          var sumMinutesEcartClient = 0\r\n          arret.minutesEcartClient.forEach(v => { sumMinutesEcartClient += v })\r\n          arret.moyMinutesEcartClient = sumMinutesEcartClient / arret.minutesEcartClient.size\r\n\r\n          var countPonctuel = 0\r\n          arret.ponctualite.forEach(v => { if (v === 'Ponctuel') { countPonctuel++ } })\r\n          arret.tauxPonctualite = countPonctuel / arret.ponctualite.size\r\n        })\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * aggregateDataForViz3() remplit l'objet vizData à partir des données du csv (data)\r\n *\r\n * @param {*} csvData L'array d'objets qui contient les lignes du csv, modifié par preprocess.addDayType()\r\n * @param {*} vizData L'array d'objets qui contient les données consolidées requises pour générer les viz\r\n * @param {*} startDate Date de début\r\n * @param {*} endDate Date de fin\r\n * @param {*} typeJour On considère semaine ou weekend\r\n * @param {*} ferie On considère les fériés si true\r\n */\r\nexport function aggregateDataForViz3 (csvData, vizData, startDate, endDate, typeJour, ferie) {\r\n  // Boucle sur les lignes de csvData pour remplir la structure vizData\r\n  for (var i = 0; i < csvData.length; i++) {\r\n    if (csvData[i].date >= startDate && csvData[i].date <= endDate && csvData[i].type_jour === typeJour && csvData[i].ferie === ferie) {\r\n      if (vizData.length === 0) {\r\n        vizData.push({ date: csvData[i].date, lignes: [] })\r\n      }\r\n\r\n      // On ajoute la date si elle n'existe pas déjà dans vizData\r\n      var posDate = vizData.findIndex(e => e.date.valueOf() === csvData[i].date.valueOf())\r\n      if (posDate === -1) {\r\n        vizData.push({ date: csvData[i].date, lignes: [] })\r\n        posDate = vizData.length - 1\r\n      }\r\n\r\n      // On ajoute la ligne si elle n'existe pas déjà dans vizData\r\n      var posLigne = vizData[posDate].lignes.findIndex(e => e.ligne === csvData[i].ligne)\r\n      if (posLigne === -1) {\r\n        vizData[posDate].lignes.push({ ligne: csvData[i].ligne, girouettes: [] })\r\n        posLigne = vizData[posDate].lignes.length - 1\r\n      }\r\n\r\n      // On ajoute la girouette si elle n'existe pas déjà dans vizData\r\n      var posGirouette = vizData[posDate].lignes[posLigne].girouettes.findIndex(e => e.girouette === csvData[i].Girouette)\r\n      if (posGirouette === -1) {\r\n        vizData[posDate].lignes[posLigne].girouettes.push({ girouette: csvData[i].Girouette, voyages: [] })\r\n        posGirouette = vizData[posDate].lignes[posLigne].girouettes.length - 1\r\n      }\r\n\r\n      // On ajoute le voyage s'il n'existe pas déjà dans vizData\r\n      var posVoyage = vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages.findIndex(e => e.voyage === csvData[i].voyage)\r\n      if (posVoyage === -1) {\r\n        vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages.push({ voyage: csvData[i].voyage, arrets: [] })\r\n        posVoyage = vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages.length - 1\r\n      }\r\n\r\n      // On ajoute l'arrêt s'il n'existe pas déjà dans vizData\r\n      var posArret = vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.findIndex(e => e.codeArret === csvData[i].arret_code)\r\n      if (posArret === -1) {\r\n        vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.push(\r\n          {\r\n            codeArret: csvData[i].arret_code,\r\n            nomArret: csvData[i].arret_nom,\r\n            sequenceArret: csvData[i].sequence_arret,\r\n            minutesEcart: csvData[i].Minutes_ecart_planifie,\r\n            nClients: csvData[i].montants,\r\n            ponctualite: csvData[i].Etat_Ponctualite,\r\n            minutesEcartClient: csvData[i].Minutes_ecart_planifie * csvData[i].montants\r\n          })\r\n        posArret = vizData[posDate].lignes[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.length - 1\r\n      }\r\n    }\r\n  }\r\n}\r\n","import * as helper from './helper.js'\r\n\r\nconst MARGIN = { top: 52, right: 80, bottom: 100, left: 80 }\r\nconst FONT_SIZE = 14\r\nconst DIRECTIONS_ANGLE = -45\r\nconst QUANTILE_STROKE_COLOR = 'black'\r\nconst QUANTILE_FILL_COLOR = 'lightgray'\r\nconst QUANTILE_STROKE_WIDTH = 2\r\nconst NUMBER_OF_TICKS = 10\r\nconst GRADIENT_COLORS = ['#ff9999', '#99ff99', '#ffff99']\r\nconst GRADIENT_THRESHOLDS = ['10', '5', '0', '-5']\r\n\r\nvar selectValue = ''\r\n\r\n/**\r\n * @param vizData\r\n */\r\nexport function generateViz3 (vizData) {\r\n  // Split container in two\r\n  var container = d3.select('#grouped-quantile-graph-container')\r\n  var delayGraphContainer = container.append('div')\r\n    .style('width', '50%')\r\n    .style('height', '100%')\r\n    .style('float', 'left')\r\n  var trafficGraphContainer = container.append('div')\r\n    .style('width', '50%')\r\n    .style('height', '100%')\r\n    .style('float', 'right')\r\n\r\n  // TODO: Fetch data\r\n  var data = {}\r\n  data.lines = ['9', '22']\r\n  data.directions = ['Lafontaine', 'Montmorency', 'Côté', 'George VI']\r\n\r\n  // Regenerate graphs on resize\r\n  new ResizeObserver(() => { generateDelayGraph(delayGraphContainer, data, vizData) })\r\n    .observe(delayGraphContainer.node())\r\n  new ResizeObserver(() => { generateTrafficGraph(trafficGraphContainer, data, vizData) })\r\n    .observe(trafficGraphContainer.node())\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to fetch\r\n * @param vizData\r\n */\r\nexport function generateDelayGraph (container, data, vizData) {\r\n  // Fetch data\r\n  data.quantileSets = getDelayQuantileSets(vizData)\r\n\r\n  // Generate common graph\r\n  data.title = 'Retard Moyen'\r\n  var [svg, dataScale] = generateGroupedQuantileGraph(container, data)\r\n  var HEIGHT = container.node().getBoundingClientRect().height\r\n  var WIDTH = Math.min(HEIGHT, container.node().getBoundingClientRect().width)\r\n\r\n  // Set gradients\r\n  svg.append('defs')\r\n    .append('linearGradient')\r\n    .attr('id', 'late-grad')\r\n    .attr('x1', '0%')\r\n    .attr('x2', '0%')\r\n    .attr('y1', '0%')\r\n    .attr('y2', '100%')\r\n    .selectAll('stop')\r\n    .data([GRADIENT_COLORS[0], GRADIENT_COLORS[1]])\r\n    .enter()\r\n    .append('stop')\r\n    .style('stop-color', function (d) { return d })\r\n    .attr('offset', function (d, i) { return 100 * i + '%' })\r\n  svg.append('defs')\r\n    .append('linearGradient')\r\n    .attr('id', 'early-grad')\r\n    .attr('x1', '0%')\r\n    .attr('x2', '0%')\r\n    .attr('y1', '0%')\r\n    .attr('y2', '100%')\r\n    .selectAll('stop')\r\n    .data([GRADIENT_COLORS[1], GRADIENT_COLORS[2]])\r\n    .enter()\r\n    .append('stop')\r\n    .style('stop-color', function (d) { return d })\r\n    .attr('offset', function (d, i) { return 100 * i + '%' })\r\n  // Draw gradients\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[0]) - MARGIN.top)\r\n    .attr('y', MARGIN.top)\r\n    .attr('fill', GRADIENT_COLORS[0])\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[1]) - dataScale(GRADIENT_THRESHOLDS[0]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[0]))\r\n    .attr('fill', 'url(#late-grad)')\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[2]) - dataScale(GRADIENT_THRESHOLDS[1]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[1]))\r\n    .attr('fill', GRADIENT_COLORS[1])\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[3]) - dataScale(GRADIENT_THRESHOLDS[2]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[2]))\r\n    .attr('fill', 'url(#early-grad)')\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', HEIGHT - MARGIN.bottom - dataScale(GRADIENT_THRESHOLDS[3]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[3]))\r\n    .attr('fill', GRADIENT_COLORS[2])\r\n\r\n  // Set y axis label\r\n  svg.select('#y-axis > .label')\r\n    .text('Minute')\r\n    .attr('fill', '#898989')\r\n\r\n  // Legend\r\n  const legend = svg.insert('g', '#x-axis').style('font-size', '12px')\r\n  const middleY = (HEIGHT - MARGIN.top - MARGIN.bottom) / 2 + MARGIN.top\r\n  const squareWidth = FONT_SIZE * 2 / 3\r\n  const paddingX = FONT_SIZE * 2\r\n  const paddingY = FONT_SIZE * 1.5\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY - paddingY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[0])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY - paddingY + squareWidth)\r\n    .text('Retard')\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[1])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY + squareWidth)\r\n    .text('Ponctuel')\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY + paddingY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[2])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY + paddingY + squareWidth)\r\n    .text('Avance')\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to fetch\r\n * @param vizData\r\n */\r\nexport function generateTrafficGraph (container, data, vizData) {\r\n  // Fetch data\r\n  const [quantileTripSets, quantileDaySets, quantileWeekSets] = getTrafficQuantileSets(vizData)\r\n  if (selectValue === '') {\r\n    data.quantileSets = quantileTripSets\r\n  } else {\r\n    if (selectValue === 'week') {\r\n      data.quantileSets = quantileWeekSets\r\n    } else if (selectValue === 'day') {\r\n      data.quantileSets = quantileDaySets\r\n    } else if (selectValue === 'trip') {\r\n      data.quantileSets = quantileTripSets\r\n    }\r\n  }\r\n\r\n  // Create select\r\n  const weekOption = document.createElement('option')\r\n  weekOption.value = 'week'\r\n  weekOption.innerHTML = 'semaine'\r\n  const dayOption = document.createElement('option')\r\n  dayOption.value = 'day'\r\n  dayOption.innerHTML = 'jour'\r\n  const tripOption = document.createElement('option')\r\n  tripOption.value = 'trip'\r\n  tripOption.innerHTML = 'trajet'\r\n  const select = document.createElement('select')\r\n  select.appendChild(tripOption)\r\n  select.appendChild(dayOption)\r\n  select.appendChild(weekOption)\r\n  if (selectValue !== '') {\r\n    select.value = selectValue\r\n  }\r\n  select.addEventListener('change', function () {\r\n    if (this.value === 'week') {\r\n      data.quantileSets = quantileWeekSets\r\n    } else if (this.value === 'day') {\r\n      data.quantileSets = quantileDaySets\r\n    } else if (this.value === 'trip') {\r\n      data.quantileSets = quantileTripSets\r\n    }\r\n    selectValue = this.value\r\n    setTrafficGraph(container, data, select)\r\n  })\r\n  // generate traffic graph\r\n  setTrafficGraph(container, data, select)\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to fetch\r\n * @param {object} select select\r\n */\r\nexport function setTrafficGraph (container, data, select) {\r\n  // Generate common graph\r\n  data.title = 'Achalandage Moyen'\r\n  var [svg] = generateGroupedQuantileGraph(container, data)\r\n\r\n  // Position select\r\n  const top = svg.node().getBoundingClientRect().top + 30\r\n  const left = svg.node().getBoundingClientRect().left + MARGIN.left - 70\r\n  select.setAttribute('style', `position: absolute; top: ${top}px; left: ${left}px; font-size: 12px`)\r\n  container.node().appendChild(select)\r\n\r\n  // Label\r\n  svg.select('#y-axis > .label')\r\n    .text('')\r\n  svg.select('#y-axis > .label')\r\n    .append('tspan')\r\n    .attr('x', (MARGIN.left - 1).toString())\r\n    .attr('y', '13')\r\n    .text('Nombre de')\r\n  svg.select('#y-axis > .label')\r\n    .append('tspan')\r\n    .attr('x', (MARGIN.left + 9).toString())\r\n    .attr('y', '25')\r\n    .text('personnes par')\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to display\r\n * @returns {Selection} The generated graph as svg\r\n */\r\nexport function generateGroupedQuantileGraph (container, data) {\r\n  // ===================== SETUP =====================\r\n\r\n  // Delete existing content\r\n  container.html('')\r\n  // Set size\r\n  var HEIGHT = container.node().getBoundingClientRect().height\r\n  var WIDTH = Math.min(HEIGHT, container.node().getBoundingClientRect().width)\r\n  var BAR_WIDTH = (WIDTH - MARGIN.left - MARGIN.right) / 7\r\n  // Create svg\r\n  var svg = container.append('svg')\r\n    .attr('width', WIDTH)\r\n    .attr('height', HEIGHT)\r\n    .attr('style', 'display: block; margin: auto')\r\n\r\n  // ===================== SCALES =====================\r\n\r\n  // Create lines scale\r\n  var linesScale = d3.scaleOrdinal()\r\n    .domain(data.lines)\r\n    .range([MARGIN.left + 2 * BAR_WIDTH, MARGIN.left + 5 * BAR_WIDTH])\r\n  // Create directions scale\r\n  var directionsRange = []\r\n  for (const line of data.lines) {\r\n    directionsRange.push(linesScale(line) - BAR_WIDTH / 2)\r\n    directionsRange.push(linesScale(line) + BAR_WIDTH / 2)\r\n  }\r\n  var directionsScale = d3.scaleOrdinal()\r\n    .domain([...data.directions])\r\n    .range(directionsRange)\r\n  // Create data scale\r\n  var maxValue = Number.MIN_SAFE_INTEGER\r\n  var minValue = Number.MAX_SAFE_INTEGER\r\n  for (const quantiles of data.quantileSets) {\r\n    for (const quantile of quantiles) {\r\n      if (maxValue < quantile) {\r\n        maxValue = quantile\r\n      }\r\n      if (minValue > quantile) {\r\n        minValue = quantile\r\n      }\r\n    }\r\n  }\r\n  var dataScale = d3.scaleLinear()\r\n    .domain([Math.min(minValue, 0), maxValue])\r\n    .range([HEIGHT - MARGIN.bottom - FONT_SIZE / 2, MARGIN.top + FONT_SIZE / 2])\r\n\r\n  // ===================== X AXIS =====================\r\n\r\n  var xAxis = svg.append('g')\r\n    .attr('id', 'x-axis')\r\n  // Draw axis line\r\n  xAxis.append('path')\r\n    .attr('d', d3.line()([\r\n      [MARGIN.left, HEIGHT - MARGIN.bottom],\r\n      [MARGIN.left + 7 * BAR_WIDTH, HEIGHT - MARGIN.bottom]\r\n    ]))\r\n    .attr('stroke', 'black')\r\n  // Draw line values\r\n  const lineValuesY = HEIGHT - MARGIN.bottom + FONT_SIZE * 1.5\r\n  for (const line of data.lines) {\r\n    xAxis.append('text')\r\n      .attr('x', linesScale(line))\r\n      .attr('y', lineValuesY)\r\n      .attr('text-anchor', 'middle')\r\n      .text(line)\r\n      .attr('fill', '#898989')\r\n      .style('font-size', FONT_SIZE)\r\n  }\r\n  // Draw direction values\r\n  const directionValuesY = lineValuesY + FONT_SIZE\r\n  for (let i = 0; i < data.directions.length; i++) {\r\n    const x = directionsScale(data.directions[i])\r\n    xAxis.append('text')\r\n      .attr('text-anchor', 'end')\r\n      .attr('transform', `translate(${x}, ${directionValuesY}) rotate(${DIRECTIONS_ANGLE})`)\r\n      .text(data.directions[i])\r\n      .style('font-size', '12px')\r\n      .attr('font-family', 'sans-serif')\r\n      .attr('class', `direction${i} label`)\r\n  }\r\n  // Draw labels\r\n  xAxis.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE / 2)\r\n    .attr('y', lineValuesY)\r\n    .text('Ligne')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n  xAxis.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE / 2)\r\n    .attr('y', directionValuesY + FONT_SIZE)\r\n    .text('Direction')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  // ===================== Y AXIS =====================\r\n\r\n  var yAxis = svg.append('g')\r\n    .attr('id', 'y-axis')\r\n  // Draw axis line\r\n  yAxis.append('path')\r\n    .attr('d', d3.line()([\r\n      [MARGIN.left, MARGIN.top],\r\n      [MARGIN.left, HEIGHT - MARGIN.bottom]\r\n    ]))\r\n    .attr('stroke', 'black')\r\n  // Generate steps\r\n  var steps = helper.getSteps(NUMBER_OF_TICKS, dataScale.domain())\r\n  for (const step of steps) {\r\n    const y = dataScale(step)\r\n    // Draw data values\r\n    yAxis.append('text')\r\n      .attr('text-anchor', 'end')\r\n      .attr('x', MARGIN.left - FONT_SIZE)\r\n      .attr('y', y + FONT_SIZE / 3)\r\n      .text(step)\r\n      .attr('font-family', 'sans-serif')\r\n      .style('font-size', FONT_SIZE)\r\n    // Draw ticks\r\n    yAxis.append('path')\r\n      .attr('d', d3.line()([\r\n        [MARGIN.left - FONT_SIZE / 2, y],\r\n        [MARGIN.left, y]]\r\n      ))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n  }\r\n  // Draw labels\r\n  yAxis.append('text')\r\n    .attr('x', MARGIN.left - FONT_SIZE / 2)\r\n    .attr('y', MARGIN.top - FONT_SIZE / 2)\r\n    .attr('class', 'label')\r\n    .attr('text-anchor', 'end')\r\n    .text('Unité de données')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  // ===================== CANDLES =====================\r\n\r\n  var bars = svg.append('g')\r\n    .attr('id', 'candles')\r\n\r\n  // HISTOGRAMME\r\n\r\n  /* for (let i = 0; i < data.quantileSets.length; i++) {\r\n    // Features of the histogram\r\n    var histogram = d3.histogram()\r\n      .domain(dataScale.domain())\r\n      .thresholds(dataScale.ticks(50)) // Important: how many bins approx are going to be made? It is the 'resolution' of the violin plot\r\n      .value(d => d)\r\n    const bins = histogram(data.quantileSets[i])\r\n    // What is the biggest number of value in a bin? We need it cause this value will have a width of 100% of the bandwidth.\r\n    var maxNum = 0\r\n    for (const bin of bins) {\r\n      if (bin.length > maxNum) {\r\n        maxNum = bin.length\r\n      }\r\n    }\r\n    // The maximum width of a violin must be x.bandwidth = the width dedicated to a group\r\n    var xNum = d3.scaleLinear()\r\n      .range([0, BAR_WIDTH])\r\n      .domain([-maxNum, maxNum])\r\n    // Add the shape to this svg!\r\n    const areaGenerator = d3.area()\r\n      .x0((d) => xNum(-d.length))\r\n      .x1((d) => xNum(d.length))\r\n      .y((d) => dataScale(d.x0))\r\n      .curve(d3.curveStep)\r\n    bars.append('path')\r\n      .attr('transform', `translate(${directionsScale(data.directions[i]) - BAR_WIDTH / 2})`)\r\n      .style('fill', '#69b3a2')\r\n      .attr('d', areaGenerator(bins))\r\n  } */\r\n\r\n  for (let i = 0; i < data.quantileSets.length; i++) {\r\n    const x = directionsScale(data.directions[i])\r\n    const top = dataScale(data.quantileSets[i][4])\r\n    const q3 = dataScale(data.quantileSets[i][3])\r\n    const q2 = dataScale(data.quantileSets[i][2])\r\n    const q1 = dataScale(data.quantileSets[i][1])\r\n    const bottom = dataScale(data.quantileSets[i][0])\r\n    // Draw domain line\r\n    bars.append('path')\r\n      .attr('d', d3.line()([[x, top], [x, bottom]]))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw Q1 to Q3 bar\r\n    bars.append('rect')\r\n      .attr('width', BAR_WIDTH)\r\n      .attr('x', x - BAR_WIDTH / 2)\r\n      .attr('height', q1 - q3)\r\n      .attr('y', q3)\r\n      .attr('fill', QUANTILE_FILL_COLOR)\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw Q2 line\r\n    bars.append('path')\r\n      .attr('d', d3.line()([[x - BAR_WIDTH / 2, q2], [x + BAR_WIDTH / 2, q2]]))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw quantile values\r\n    const yValues = [0, 0, 0, 0, 0]\r\n    const minOffset = 11\r\n    const centerOffset = 4\r\n    yValues[2] = dataScale(data.quantileSets[i][2]) + centerOffset\r\n    yValues[3] = Math.min(yValues[2] - minOffset, dataScale(data.quantileSets[i][3]) + centerOffset)\r\n    yValues[4] = Math.min(yValues[3] - minOffset, dataScale(data.quantileSets[i][4]) + centerOffset)\r\n    yValues[1] = Math.max(yValues[2] + minOffset, dataScale(data.quantileSets[i][1]) + centerOffset)\r\n    yValues[0] = Math.max(yValues[1] + minOffset, dataScale(data.quantileSets[i][0]) + centerOffset)\r\n    for (let j = 0; j < data.quantileSets[i].length; j++) {\r\n      const quantile = bars.append('g')\r\n        .attr('class', `direction${i} quantile`)\r\n        .style('visibility', 'hidden')\r\n      const x = directionsScale(data.directions[i]) + (i % 2 === 0 ? -1 : 1) * (BAR_WIDTH / 2 + FONT_SIZE / 2)\r\n      quantile.append('text')\r\n        .attr('x', x)\r\n        .attr('y', yValues[j])\r\n        .attr('text-anchor', (i % 2 === 0 ? 'end' : 'start'))\r\n        .text(Math.round(data.quantileSets[i][j]))\r\n        .style('font-size', FONT_SIZE)\r\n        .attr('id', `quantile-text-${i}-${j}`)\r\n    }\r\n  }\r\n\r\n  // ===================== HOVER =====================\r\n\r\n  // Create triggers\r\n  for (let i = 0; i < data.directions.length; i++) {\r\n    bars.append('rect')\r\n      .attr('width', BAR_WIDTH)\r\n      .attr('x', directionsScale(data.directions[i]) - BAR_WIDTH / 2)\r\n      .attr('height', dataScale.range()[0] - dataScale.range()[1] + FONT_SIZE)\r\n      .attr('y', MARGIN.top)\r\n      .attr('fill', 'transparent')\r\n      // Highlight direction\r\n      .on('mouseover', () => {\r\n        d3.selectAll(`.direction${i}`)\r\n          .attr('stroke-width', QUANTILE_STROKE_WIDTH * 2)\r\n        d3.selectAll(`.direction${i}.label`)\r\n          .attr('font-weight', 1000)\r\n        d3.selectAll(`.direction${i}.quantile`)\r\n          .style('visibility', 'visible')\r\n      // Unhighlight direction\r\n      }).on('mouseout', () => {\r\n        d3.selectAll(`.direction${i}`)\r\n          .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n        d3.selectAll(`.direction${i}.label`)\r\n          .attr('font-weight', 0)\r\n        d3.selectAll(`.direction${i}.quantile`)\r\n          .style('visibility', 'hidden')\r\n      })\r\n  }\r\n\r\n  // ===================== OTHER =====================\r\n\r\n  // Draw Title\r\n  svg.append('text')\r\n    .attr('x', (WIDTH - MARGIN.right - MARGIN.left) / 2 + MARGIN.left)\r\n    .attr('y', MARGIN.top - FONT_SIZE * 2)\r\n    .attr('text-anchor', 'middle')\r\n    .text(data.title)\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  return [svg, dataScale]\r\n}\r\n\r\n/**\r\n * @param {object} vizData Project data\r\n * @returns {Array<number>} The quantile sets\r\n */\r\nexport function getDelayQuantileSets (vizData) {\r\n  const quantileSets = []\r\n  const delaySets = [[], [], [], []]\r\n  for (const day of vizData) {\r\n    for (let i = 0; i < day.lignes.length; i++) {\r\n      const line = day.lignes[i]\r\n      for (let j = 0; j < line.girouettes.length; j++) {\r\n        const direction = line.girouettes[j]\r\n        for (const trip of direction.voyages) {\r\n          for (const stop of trip.arrets) {\r\n            delaySets[i * day.lignes.length + j].push(stop.minutesEcart)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  for (const delaySet of delaySets) {\r\n    quantileSets.push(helper.getQuantiles(delaySet))\r\n  }\r\n  return quantileSets\r\n}\r\n\r\n/**\r\n * @param {object} vizData Project data\r\n * @returns {Array<number>} The quantile sets\r\n */\r\nexport function getTrafficQuantileSets (vizData) {\r\n  const tripSets = [[], [], [], []]\r\n  const daySets = [[], [], [], []]\r\n  const weekSets = [[], [], [], []]\r\n  let lastWeek = helper.getWeekNumber(new Date(Date.parse(vizData[0].date)))[1]\r\n  let weekClients = [0, 0, 0, 0]\r\n  for (const day of vizData) {\r\n    const week = helper.getWeekNumber(new Date(Date.parse(day.date)))[1]\r\n    for (let i = 0; i < day.lignes.length; i++) {\r\n      const line = day.lignes[i]\r\n      for (let j = 0; j < line.girouettes.length; j++) {\r\n        const direction = line.girouettes[j]\r\n        let dayClients = 0\r\n        for (const trip of direction.voyages) {\r\n          let tripClients = 0\r\n          for (const stop of trip.arrets) {\r\n            tripClients += stop.nClients\r\n          }\r\n          dayClients += tripClients\r\n          tripSets[i * day.lignes.length + j].push(tripClients)\r\n        }\r\n        daySets[i * day.lignes.length + j].push(dayClients)\r\n        weekClients[i * day.lignes.length + j] += dayClients\r\n      }\r\n    }\r\n    if (lastWeek !== week) {\r\n      for (let i = 0; i < weekClients.length; i++) {\r\n        weekSets[i].push(weekClients[i])\r\n      }\r\n      weekClients = [0, 0, 0, 0]\r\n      lastWeek = week\r\n    }\r\n  }\r\n  const quantileTripSets = []\r\n  for (const tripSet of tripSets) {\r\n    quantileTripSets.push(helper.getQuantiles(tripSet))\r\n  }\r\n  const quantileDaySets = []\r\n  for (const daySet of daySets) {\r\n    quantileDaySets.push(helper.getQuantiles(daySet))\r\n  }\r\n  const quantileWeekSets = []\r\n  for (const weekSet of weekSets) {\r\n    quantileWeekSets.push(helper.getQuantiles(weekSet))\r\n  }\r\n  return [quantileTripSets, quantileDaySets, quantileWeekSets]\r\n}\r\n","'use strict'\r\n\r\nimport * as helper from './scripts/helper.js'\r\nimport * as preprocess from './scripts/preprocess.js'\r\nimport * as groupedQuantile from './scripts/grouped-quantile.js'\r\n\r\n/**\r\n * @file \r\n * @author Adam Prévost, Armelle Jézéquel, Clara Serruau, Jules Lefebvre, Julien Dupuis\r\n * @version 1.0.0\r\n * \r\n * La structure du projet est inspirée de celle employé pour les TPs de INF8808 créée par Olivia Gélinas.\r\n */\r\n\r\n(function (d3) {\r\n  const svgSize = {\r\n    width: 800,\r\n    height: 625\r\n  }\r\n\r\n  helper.setCanvasSize(svgSize.width, svgSize.height)\r\n  helper.generateMapG(svgSize.width, svgSize.height)\r\n  helper.generateMarkerG(svgSize.width, svgSize.height)\r\n\r\n  // Solution temporaire, éventuellement l'utilisateur peut choisir la période qui l'intéresse, s'il veut inclure les week-end et les fériés.\r\n  const startDate = new Date('2021/09/01')\r\n  const endDate = new Date('2021/12/01')\r\n  const typeJour = 'semaine'\r\n  const ferie = false\r\n\r\n  var vizData = []\r\n\r\n  build()\r\n\r\n  /**\r\n   *   Cette fonction construit la page web\r\n   */\r\n  function build () {\r\n    d3.csv('./donnees_L9_L22.csv').then(function (csvData) {\r\n      // Change les string pour les types appropriés\r\n      csvData.forEach(function (d) {\r\n        d.date = new Date(d.date + ' 00:00:00')\r\n        d.ligne = +d.ligne\r\n        d.voyage = +d.voyage\r\n        d.arret_code = +d.arret_code\r\n        d.montants = +d.montants\r\n        d.Minutes_ecart_planifie = +d.Minutes_ecart_planifie\r\n        d.sequence_arret = +d.sequence_arret\r\n        d.arret_Latitude = +d.arret_Latitude\r\n        d.arret_Longitude = +d.arret_Longitude\r\n      })\r\n      preprocess.addDayType(csvData)\r\n      preprocess.aggregateDataForViz3(csvData, vizData, startDate, endDate, typeJour, ferie)\r\n      groupedQuantile.generateViz3(vizData)\r\n    })\r\n  }\r\n})(d3)\r\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}